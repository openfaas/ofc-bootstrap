provider:
  name: faas
  gateway: http://127.0.0.1:8080

functions:
  system-gitlab-event:
    lang: go
    handler: ./gitlab-event
    image: functions/gitlab-event:0.1.1
    labels:
      openfaas-cloud: "1"
      role: openfaas-system
    environment:
      content_type: text/plain
      validate_customers: true
      validate_token: false
      write_debug: true
      read_debug: true
      installation_tag: "openfaas-cloud"
      gitlab_instance: "{{.GitLabInstance}}"
    environment_file:
      - gateway_config.yml
    secrets:
      - gitlab-webhook-secret
      - payload-secret
      - gitlab-api-token 

  gitlab-status:
    lang: go
    handler: ./gitlab-status
    image: functions/gitlab-status:0.1.0
    labels:
      openfaas-cloud: "1"
      role: openfaas-system
    environment:
      write_debug: true
      read_debug: true
    environment_file:
      - gateway_config.yml
    secrets:
      - gitlab-api-token
      - payload-secret 
      
  gitlab-push:
    lang: go
    handler: ./gitlab-push
    image: functions/gitlab-push:0.2.0
    labels:
      openfaas-cloud: "1"
      role: openfaas-system
    environment:
      write_debug: true
      read_debug: true
    environment_file:
      - gateway_config.yml
    secrets:
      - payload-secret

  ## Post-deployed with gitlab with `gitlab-api-token` secret
  git-tar:
    lang: dockerfile
    handler: ./git-tar
    image: functions/of-git-tar:0.9.1
    labels:
      openfaas-cloud: "1"
      role: openfaas-system
    environment:
      read_timeout: 15m
      write_timeout: 15m
      write_debug: true
      read_debug: true
    environment_file:
      - gateway_config.yml
      - github.yml
    secrets:
      - payload-secret
      - private-key
      - gitlab-api-token